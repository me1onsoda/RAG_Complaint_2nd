import csv

# -------------------------------------------------------------
# 1. 파일 설정 (스크린샷에 보이는 파일명으로 지정)
# -------------------------------------------------------------
input_file = "nowon_org_chart_final.csv"  # 뭉쳐있는 원본 파일
output_file = "노원구_조직도_완료.csv"  # 깔끔하게 정리된 결과 파일

print(f"🚀 '{input_file}' 데이터를 정리하기 시작합니다...")

try:
    with open(input_file, 'r', encoding='utf-8-sig') as f_in, \
            open(output_file, 'w', newline='', encoding='utf-8-sig') as f_out:

        reader = csv.reader(f_in)
        writer = csv.writer(f_out)

        # -------------------------------------------------------------
        # 2. 헤더(제목) 만들기
        # -------------------------------------------------------------
        # 뭉쳐진 데이터가 쪼개지면 들어갈 자리들입니다.
        # 실제 데이터 순서에 맞춰서 가장 일반적인 순서로 배치합니다.
        headers = ["No", "대분류(국/과)", "팀명", "직위/이름", "담당업무", "전화번호", "기타"]
        writer.writerow(headers)

        # 첫 줄(제목 줄)은 건너뛰기 (원본 파일에 제목이 있다면)
        # 만약 원본 첫 줄부터 데이터라면 아래 next(reader)는 지워주세요.
        next(reader, None)

        # -------------------------------------------------------------
        # 3. 한 줄씩 읽어서 쪼개기
        # -------------------------------------------------------------
        count = 0
        for row in reader:
            if not row: continue  # 빈 줄은 패스

            # 스크린샷을 보면: [0]부서, [1]페이지, [2]정보(뭉친거) 순서입니다.
            # 만약 순서가 다르면 아래 숫자를 조정해야 합니다.
            main_dept = row[0]  # 맨 앞의 '감사담당관' 같은 대분류

            # 뭉쳐있는 정보 가져오기 (혹시 컬럼이 모자랄까봐 예외처리)
            if len(row) > 2:
                messy_text = row[2]
            else:
                messy_text = ""

            # '|' 기호를 기준으로 토막냅니다.
            # 예: "감사팀 | 주무관 | 서무 | 02-..."  ->  ["감사팀", "주무관", "서무", "02-..."]
            parts = messy_text.split('|')

            # 토막낸 글자들의 앞뒤 공백을 제거합니다. (깔끔하게)
            clean_parts = [p.strip() for p in parts]

            # ---------------------------------------------------------
            # [데이터 매핑] 잘라낸 조각들을 엑셀 칸에 배치
            # ---------------------------------------------------------
            # 노원구 데이터 특성상 부서/팀/직위 순서가 조금씩 다를 수 있어
            # 일단 잘라진 순서대로 칸을 채우고, 나중에 엑셀에서 살짝 다듬는 게 가장 안전합니다.

            # 기본 데이터 구성: [순번, 대분류] + [잘라낸 조각들...]
            save_row = [count + 1, main_dept] + clean_parts

            writer.writerow(save_row)
            count += 1

    print("\n" + "=" * 50)
    print(f"🎉 정리 끝! 총 {count}명의 데이터를 변환했습니다.")
    print(f"💾 '{output_file}' 파일을 열어서 확인해보세요!")
    print("=" * 50)

except FileNotFoundError:
    print(f"❌ 오류: '{input_file}' 파일을 찾을 수 없습니다. 파일명이 맞는지 확인해주세요!")
except Exception as e:
    print(f"❌ 오류 발생: {e}")